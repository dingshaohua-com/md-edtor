## 光标问题

这是一个非常经典的问题，在基于 ProseMirror 的编辑器（如 Milkdown）中，如果文档以代码块（Code Block）结尾，光标确实会被“困”在代码块的最后一行，按回车只会增加代码行，而无法跳出容器。

这是因为代码块是一种“隔离容器”，它默认捕获了所有的换行行为。

---

### 1. 为什么会“打字永远在代码块内”？

* **节点性质限制**：代码块在 ProseMirror 的 Schema 中被定义为 `leaf` 节点或具有特定内容的父节点。由于它是文档的最后一个节点，文档没有后续的“空位”（Paragraph）供光标落脚。
* **回车键被捕获**：在代码块内按回车，`commonmark` 插件会认为你是在输入新的一行代码，而不是要结束当前块。

---

### 2. 解决方案 A：安装 `@milkdown/plugin-cursor` (最推荐)

Milkdown 官方为了解决这个问题，专门提供了一个**光标增强插件**。它会在代码块等复杂节点的前后自动维护一个“虚拟落脚点”。

```tsx

import { cursor } from '@milkdown/kit/plugin/cursor'

Editor.make()
  .use(commonmark)
  .use(cursor) // 核心：加入这个插件
  // ... 其他配置

```

* **效果**：当你处于代码块最后一行并连续按两次回车，或者光标在最末尾按方向键“下”，它会自动在代码块下方帮你创建一个新的空段落。

---

### 3. 解决方案 B：通过 Keymap 自定义快捷键跳出

如果你不想多装一个插件，可以通过自定义快捷键，让 `Shift + Enter` 或连按两次 `Enter` 强行跳出：

```tsx

import { commandsCtx } from '@milkdown/core';
import { insertDefaultValueCommand } from '@milkdown/preset-commonmark';

// 在 config 中配置
.config((ctx) => {
  // 这种方法相对硬核，需要通过命令系统在当前节点后强行插入一个 p 节点
})

```

---

### 4. 解决方案 C：用户操作技巧（临时方案）

其实在很多 Markdown 编辑器中，有一个通用的“跳出”逻辑：

* **按 `Cmd/Ctrl + Enter**`：在很多实现中，这被定义为“结束当前块并开启新行”。
* **在代码块底部按键盘 `↓`（向下键）**：如果安装了 `cursor` 插件，这能直接触发跳出逻辑。

---

### 💡 语雀/Notion 是怎么做的？

语雀和 Notion 实际上在每个块级元素（如代码块）下方都始终预留了一个微小的“点击感应区”。

在 Milkdown 中，这对应的就是 **`gapcursor`**（间隙光标）。`@milkdown/plugin-cursor` 内部就集成了这种机制，能让你在代码块和文档底部之间看到一条细细的横线，点击它就能直接跳出。

### 总结建议

既然你已经移除了 `nord` 主题，追求的是语雀般的丝滑体验，那么 **`@milkdown/plugin-cursor` 是必装的**。它不仅解决了代码块跳出的问题，还解决了文档开头是代码块时无法向上插入内容的问题。

**装上插件试一下，现在连续按回车能不能跳出代码块了？如果还是不行，我们需要检查一下你的 `commonmark` 插件版本。**